{"componentChunkName":"component---src-templates-post-template-tsx","path":"/2024-08-23/Docker-MariaDB/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>1. 계기</h2>\n<p>다른 업체들간 데이터 연계를 위해 DB를 만들어야할 일이 생겼다. PostgresDB가 익숙하지만, 업체의 요청에 따라 MariaDB로 만들게 되었다. 그 과정을 공유해보고자 한다. 사실 도커로 DB 생성하는것은 굉장히 간한단 일이지만, api를 통해 데이터 input을 지원해야 해서 글거리가 생긴 것 같다. 이 글에서는 Docker 및 docker-compose로 MariaDB를 생성하고, 추후 Express.js API서버와 연동한다.</p>\n</br>\n<h2>2. 도커 기반 Maria DB 생성</h2>\n<h3>2-1. Dockerfile 작성</h3>\n<p>MariaDB를 사용하기 위해 Dockerfile을 작성한다. 버전의 제약은 별도로 없으므로 최신버전(latest)를 사용하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token comment\"># Dockerfile</span>\r\n<span class=\"token instruction\"><span class=\"token keyword\">FROM</span> mariadb:latest</span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> init.sql /docker-entrypoint-initdb.d/</span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">EXPOSE</span> 3306</span>\r\n</code></pre></div>\n<p>FROM에 사용할 도커 이미지를 작성한다. <code class=\"language-text\">이미지:버전</code> 의 형태로 작성하면 된다. 여기선 최신버전으로 latest를 사용했지만, 특정 버전을 원한다면 적어주면 된다.</p>\n<p>COPY는 도커 컨테이너 생성 시 복사할 파일을 의미한다. 이게 무슨 말이냐면, 로컬에서 설정파일을 만들어 두고 해당 명령어를 통해 도커 컨테이너 내부에서 적용되게끔 한다. 일종의 마운트 개념으로 이해하면 된다.</p>\n<p>EXPOSE는 DB에서 사용할 포트번호를 작성한다. 참고로 MariaDB의 기본 포트는 3306이다.</p>\n<br/>\n<h3>2-2. docker-compose.yml 작성</h3>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token comment\"># docker-compose.yml</span>\r\n<span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.8'</span>\r\n\r\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">mariadb</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> dbdbdeep_db\r\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> .\r\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token key atrule\">MARIADB_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> dbdbdeep01@\r\n      <span class=\"token key atrule\">MARIADB_DATABASE</span><span class=\"token punctuation\">:</span> 데이터베이스명\r\n      <span class=\"token key atrule\">MARIADB_USER</span><span class=\"token punctuation\">:</span> 유저명\r\n      <span class=\"token key atrule\">MARIADB_PASSWORD</span><span class=\"token punctuation\">:</span> 패스워드\r\n      <span class=\"token key atrule\">TZ</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Asia/Seoul'</span>\r\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'3306:3306'</span>\r\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> db_data<span class=\"token punctuation\">:</span>/var/lib/mysql\r\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> dbdbdeep_net\r\n\r\n<span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">db_data</span><span class=\"token punctuation\">:</span>\r\n\r\n<span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">dbdbdeep_net</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">external</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>위와같이 필요한값을 채워서 만들면 된다. 특이사항은 <code class=\"language-text\">networks</code>를 사용하였는데, 추후 express api를 같은 대역에서 사용하기 위해 적용하였다. 그리고 datetime 통일을 위해 타임존을 한국시간대로 설정하였다. 어차피 DB에서는 datetime을 ISO표준으로 사용할 예정이기 때문에 값을 신경쓰지 않아도 된다는 장점이 있다.</p>\n<p>이게 무슨말이냐면, DB에 저장되는 값은 UTC기준으로 설정이 된다. 그리고 DB의 값을 읽어올 때 해당 시간대로 적용이 된다는 의미이다. 예를 들어 저장된 시간이 00:00 이라면(HH:MM), 한국에서 서비스 되는 곳이라면 읽었을 때 09:00 (Asia/Seoul +09:00)이 적용된다는 뜻이다.</p>\n<p>volumes의 db_data 경로를 도커 컨테이너 내부의 /var/lib/mysql에 마운트 하였다.\r\n이것은 DB의 데이터가 저장될 경로를 의미하며, 이를 통해 데이터의 영속성을 보장할 수 있다.</p>\n<br/>\n<h3>2-3. 설정파일</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- init.sql</span>\r\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">DATABASE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> 데이터베이스명<span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">USE</span> 데이터베이스명<span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>테이블명<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span>\r\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ID<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>NAME<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'이름'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>CREATE_DATE<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'생성일'</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">ALL</span> <span class=\"token keyword\">PRIVILEGES</span> <span class=\"token keyword\">ON</span> 데이터베이스명<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token keyword\">TO</span> <span class=\"token string\">'유저명'</span><span class=\"token variable\">@'%'</span> IDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'패스워드'</span><span class=\"token punctuation\">;</span>\r\nFLUSH <span class=\"token keyword\">PRIVILEGES</span><span class=\"token punctuation\">;</span>\r\n\r\n</code></pre></div>\n<p>Dockerfile에서 설정파일로 마운트한 init.db의 내용이다.\r\nDB를 생성하기 위한 스크립트에 해당하는데, 위 스크립트는 간단한 예시로 만들었다.</p>\n<p>필요에 따라 올바른 테이블과 컬럼을 구성한다.</p>\n<h2>실행</h2>\n<p>작업 경로에서 <code class=\"language-text\">docker compose up -d </code> 명령을 통해 도커 컨테이너를 구동하면 된다.</p>\n</br>","frontmatter":{"title":"[Docker] MariaDB 간단 생성","summary":"Docker를 이용하여 간단한 MariaDB를 만들어봅니다. 그리고 필요한 설정 방법들을 작성합니다.","date":"2024.08.23.","categories":["Docker","MariaDB","DB"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoklEQVR42mOYPm/Df2piBroaOGP+RjCePg9GU2Ig0IAps9b8nzJ7DZg/ZfZaMD1t7nrSDQRpmrVwy/+Gtmn/45Jy/+cVN/xPSiv+n5Zd/r+9bx5YDpfBDPi82zd16f+mjun/G9un/W/qnPm/vnXK//5py/F6H7uBQNtnLtj0v6N/PtCVU/7XNk/639I9639dy2SwGOkGohi+jmC4DVyyIcdAAIeDPGrDgDbiAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/93f8ef3e3289585b28d2d827f05dda86/9b7d7/thumnail.png","srcSet":"/static/93f8ef3e3289585b28d2d827f05dda86/5d231/thumnail.png 192w,\n/static/93f8ef3e3289585b28d2d827f05dda86/e1116/thumnail.png 384w,\n/static/93f8ef3e3289585b28d2d827f05dda86/9b7d7/thumnail.png 768w","sizes":"(min-width: 768px) 768px, 100vw"},"sources":[{"srcSet":"/static/93f8ef3e3289585b28d2d827f05dda86/a3a09/thumnail.webp 192w,\n/static/93f8ef3e3289585b28d2d827f05dda86/5358b/thumnail.webp 384w,\n/static/93f8ef3e3289585b28d2d827f05dda86/81e8e/thumnail.webp 768w","type":"image/webp","sizes":"(min-width: 768px) 768px, 100vw"}]},"width":768,"height":402}},"publicURL":"/static/93f8ef3e3289585b28d2d827f05dda86/thumnail.png"}}}}]}},"pageContext":{"slug":"/2024-08-23/Docker-MariaDB/"}},"staticQueryHashes":["3649515864","63159454"],"slicesMap":{}}