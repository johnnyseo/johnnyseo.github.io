{"componentChunkName":"component---src-templates-post-template-tsx","path":"/2024-03-13/Spring-Boot-CORS-해결/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>1. 문제발생</h2>\n<p>Spring Boot 에서 CORS 에러 문제를 해결하는 방법입니다.\r\n인계받은 프로젝트에서는 Spring Boot 를 미들웨어로 사용 중인데, 수정사항이 생겨 반영 후 첫 배포를 해보니 클라이언트에서 CORS에러가 발생하고 있었습니다.</p>\n<p><br/><br/>\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ea9dc9a839287ad5894fa895bfe1a37f/5d3a1/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkElEQVR42p2Sz0vCYBjHZwZJ9A9036mCIsFLB+mUEUHRqT9FqS6eO3SQyEuC65DK5qlAjGG6ETEPSgybv3/g0G1uNRiks7fnlQgvHfSFL++Ph+fL53mfhyBmXAihBbzzPL+tKMpjrVaLVyqVuK7rD/V6/ZhgWXZxWpDg+EvG92mBGUmSSxByZLPZdVmWI+12O9RsNkNgflsul/dmBSS8Xq8LNidN055er8eACSWKItXv9xkwPiQANWgYRgB0Bo8X+XyenND12JWhyvqRwZ2jz5fAWHsOIp09gtDCL+EmUMUwZavVigwGg/tGo3GA/wRZljWybfsbn1Op1Ck2vL7yr43t6sgeSsjUXm2EFGR+FBgIudxu9/K/JZim2VJVtQiEb6B3QRB28buQuVm11UxhpHGiJWeKts43vpSnS0yHKXO53BbQ4TKjnU4nCoT0pORZl8/nw01xxmIxD3SYKZVKFBaYMZIkzW1IcBy3AU25A6NwtVoNa5pGwfjsE/POYSKR2AGTdLfbTUJTkvBdaRihkx/OHiVAp/EaTgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ea9dc9a839287ad5894fa895bfe1a37f/a59e9/image.webp 192w,\n/static/ea9dc9a839287ad5894fa895bfe1a37f/0ca9f/image.webp 384w,\n/static/ea9dc9a839287ad5894fa895bfe1a37f/dc9b9/image.webp 768w,\n/static/ea9dc9a839287ad5894fa895bfe1a37f/e2c2f/image.webp 1152w,\n/static/ea9dc9a839287ad5894fa895bfe1a37f/f3efb/image.webp 1536w,\n/static/ea9dc9a839287ad5894fa895bfe1a37f/6fc6a/image.webp 2124w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ea9dc9a839287ad5894fa895bfe1a37f/3b721/image.png 192w,\n/static/ea9dc9a839287ad5894fa895bfe1a37f/66595/image.png 384w,\n/static/ea9dc9a839287ad5894fa895bfe1a37f/fe486/image.png 768w,\n/static/ea9dc9a839287ad5894fa895bfe1a37f/d2d74/image.png 1152w,\n/static/ea9dc9a839287ad5894fa895bfe1a37f/e8464/image.png 1536w,\n/static/ea9dc9a839287ad5894fa895bfe1a37f/5d3a1/image.png 2124w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ea9dc9a839287ad5894fa895bfe1a37f/fe486/image.png\"\n            alt=\"alt text\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>우선 간단히 통신 구조를 설명 해보자면 위 그림과 같이 클라이언트의 요청을 받아 분석서버로 전송하고 응답을 클라이언트로 전달해주는 형태로 되어있습니다.</p>\n<p>클라이언트에서는 403 에러가 발생하고 있었습니다. 403 에러는 지정된 URL에 액세스 할 수있는 권한이 없기 때문에 발생하는 에러로, <code class=\"language-text\">URL이 유효하지만 사용자의 요청을 수행할 수 없다는 것을 의미</code>합니다.</p>\n<p><br/><br/></p>\n<p><br/><br/></p>\n<h2>2. 원인 파악</h2>\n<p>이제 Spring Boot 앱에서 원인을 찾아봅니다. 우선 우리의 미들웨어는 SSL인증서를 사용중이며, https 프로토콜을 사용합니다. (클라이언트와 분석서버에는 http 프로토콜을 사용중입니다.)</p>\n<p>보통은 개발환경에서 CORS문제를 해결하기 위해 전체 Origin에 대해 허용하는 경우가 많습니다. 아래 코드처럼요.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span></span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">CorsRegistry</span></span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebMvcConfigurer</span></span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token annotation punctuation\">@Configuration</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WebMvcConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebMvcConfigurer</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> <span class=\"token constant\">MAX_AGE_SECS</span> <span class=\"token operator\">=</span> <span class=\"token number\">3600</span><span class=\"token punctuation\">;</span>\r\n\r\n\t<span class=\"token annotation punctuation\">@Override</span>\r\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addCorsMappings</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CorsRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t\tregistry<span class=\"token punctuation\">.</span><span class=\"token function\">addMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">allowedOrigins</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span>\r\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">allowedMethods</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HEAD\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"OPTIONS\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PUT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PATCH\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"DELETE\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">maxAge</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MAX_AGE_SECS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>우리 코드도 마찬가지였습니다. (<del>그동안으 왜 된거지..</del>)<br>\n왜 이게 갑자기 문제가 되었을까? 의문이 생겼지만 아마도 이전 배포버전에서는 SSL인증서 적용이 안되었거나, 배포할때 다른 설정을 적용했기 때문일 것 같습니다. 제가 인계받은건 git레포지토리라 통신에 영향을 줄만한 수정사항이 없었는데 이런 문제가 발생했기 때문입니다.</p>\n<br />\r\n하지만 구글링을 해보니 SSL이 적용되어 https를 사용할땐 allowdOrigins에 특정 오리진을 지정해주어야 한다고 합니다. 이제 문제를 해결해봅시다.\n<p><br/><br/></p>\n<h2>3. 문제 해결</h2>\n<p>기존의 전체를 허용하던 <code class=\"language-text\">allowedOrigins</code> 함수의 인자를 변경해주면 됩니다.<br>\nallowedOrigins(”*”) => allowedOrigins(“클라이언트 URL”)</p>\n<p>만약 허용할 Origin 이 여러개라면 ,로 구분하여 나열해주면 됩니다.<br>\nex) <code class=\"language-text\">allowedOrigins(\"클라이언트URL1\", \"클라이언트URL2\", ..., \"클라이언트URLn\")</code></p>\n<p>아래는 수정한 코드 입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// WebMvcConfig.java</span>\r\n\r\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span></span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">CorsRegistry</span></span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebMvcConfigurer</span></span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token annotation punctuation\">@Configuration</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WebMvcConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebMvcConfigurer</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> <span class=\"token constant\">MAX_AGE_SECS</span> <span class=\"token operator\">=</span> <span class=\"token number\">3600</span><span class=\"token punctuation\">;</span>\r\n\r\n\t<span class=\"token annotation punctuation\">@Override</span>\r\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addCorsMappings</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CorsRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t\tregistry<span class=\"token punctuation\">.</span><span class=\"token function\">addMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/**\"</span><span class=\"token punctuation\">)</span>\r\n\t\t   <span class=\"token punctuation\">.</span><span class=\"token function\">allowedOrigins</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"클라이언트 URL\"</span><span class=\"token punctuation\">)</span>\r\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">allowedMethods</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HEAD\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"OPTIONS\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PUT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PATCH\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"DELETE\"</span><span class=\"token punctuation\">)</span>\r\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">allowedHeaders</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Authorization\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"X-Requested-With\"</span><span class=\"token punctuation\">)</span>\r\n\t            <span class=\"token punctuation\">.</span><span class=\"token function\">exposedHeaders</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Authorization\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 브라우저에 노출할 HTTP 헤더 설정</span>\r\n\t            <span class=\"token punctuation\">.</span><span class=\"token function\">allowCredentials</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 쿠키 허용 설정</span>\r\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">maxAge</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MAX_AGE_SECS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>코드를 수정하고 다시 배포했더니 요청이 잘 수행되었습니다.</p>\n<h2>4. 느낀점</h2>\n<p>이번 문제는 원인을 파악하고 난 이후에 조치는 쉬웠지만, 문제의 원인을 찾기가 어려웠습니다. 내가 작성한 코드가 아닌데다 이전 배포판은 잘 돌아가고 있기 때문에 내가 무언가를 놓치거나 실수했을거라고 생각한게 컸던것 같습니다. 하지만 클라이언트의 요청부터 하나하나 뜯어보고 분석해보니 결국엔 원인을 찾을 수 있었습니다. 통신흐름을 파악하고 Postman으로 요청해서 클라이언트의 요청과 비교해보고 어느부분이 문제인지 파악하는 과정도 중요한것 같습니다.</p>\n<p>인수인계받을때 문서를 많이 참조하였지만 최신화가 안된 부분도 있어서 오히려 헷갈리기도 했습니다. (이전 담당자에게 연락해봤지만 뾰족한 해답을 얻지는 못했습니다..)</p>\n<p>읽어주셔서 감사합니다.</p>","frontmatter":{"title":"[Spring Boot]SSL 환경의 CORS 에러 해결","summary":"Spring Boot(SSL) 에서 CORS 에러 문제를 해결하는 방법입니다.","date":"2024.03.13.","categories":["Spring Boot","문제해결"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAl0lEQVR42s2SQQ6CQAxFuf8VdECCCoJuZEBxpddoy0RP8u2oJEY3MjHGxU/72+SlbRqxSfBNRb8DTuN3P9Reex8B49ktSpJCNPfR18Q88lFAneDc7uD2HfrawtkWl+MJrjugt436ZjyQ50tQvgJnC0i5hmxrcF6A1FOaBaw8MXewwrgoQSquNiB/iqAbPokUMOiP3iYQeAW2FWvz2DFkRAAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/cf87d56c13b4b90955b598884ff688c9/9b7d7/image-2.png","srcSet":"/static/cf87d56c13b4b90955b598884ff688c9/5d231/image-2.png 192w,\n/static/cf87d56c13b4b90955b598884ff688c9/e1116/image-2.png 384w,\n/static/cf87d56c13b4b90955b598884ff688c9/9b7d7/image-2.png 768w","sizes":"(min-width: 768px) 768px, 100vw"},"sources":[{"srcSet":"/static/cf87d56c13b4b90955b598884ff688c9/a3a09/image-2.webp 192w,\n/static/cf87d56c13b4b90955b598884ff688c9/5358b/image-2.webp 384w,\n/static/cf87d56c13b4b90955b598884ff688c9/81e8e/image-2.webp 768w","type":"image/webp","sizes":"(min-width: 768px) 768px, 100vw"}]},"width":768,"height":402}},"publicURL":"/static/cf87d56c13b4b90955b598884ff688c9/image-2.png"}}}}]}},"pageContext":{"slug":"/2024-03-13/Spring-Boot-CORS-해결/"}},"staticQueryHashes":["3649515864","63159454"],"slicesMap":{}}